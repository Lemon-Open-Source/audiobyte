function playTone(frequency, duration) {
  return new Promise((resolve) => {
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    oscillator.frequency.value = frequency;
    oscillator.type = 'sine';
    gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
    gainNode.gain.linearRampToValueAtTime(0.5, audioCtx.currentTime + 0.01);
    gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + duration / 1000 - 0.01);

    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);

    oscillator.start();
    oscillator.stop(audioCtx.currentTime + duration / 1000);

    oscillator.onended = resolve;
  });
}

async function sendBytes(bytes) {
  // Start frame marker frequency around 10,000 Hz (your receiver: 9900-10050)
  await playTone(10000, 150);

  for (let byte of bytes) {
    const freq = byteToFrequency(byte);
    await playTone(freq, 100);
    await new Promise(r => setTimeout(r, 20)); // pause between tones
  }

  // End frame marker frequency around 8900 Hz (your receiver: 8800-8950)
  await playTone(8900, 150);
}

function sendText() {
  const text = document.getElementById("textInput").value;
  const bytes = stringToBytes(text);
  sendBytes(bytes);
}
